<ion-header no-border (swipe)="onSwipeContent($event)" class="dp-head">
	<ion-toolbar>
		<button ion-button menuToggle color="gray9">
			<ion-icon name="menu"></ion-icon>
		</button>
		<ion-buttons end>
			<button-cart #cart icon="cart"></button-cart>
		</ion-buttons>
	</ion-toolbar>
</ion-header>
<ion-content>
  <ion-row>
    <ion-col no-padding-hard col-10>
        <ion-searchbar #si
        autocomplete="on"
        autocorrect="on"
        placeholder="{{'search.title'|translate}}"
        [(ngModel)]="keyword"
        [showCancelButton]="true"
        cancelButtonText="Cancelar"
        (ionInput)="search($event)"
        (ionCancel)="onCancel($event)">
      </ion-searchbar>
    </ion-col>
    <ion-col col-2 padding-12>
        <img src="assets/images/barcode.png" (click)="openCamera()" />
    </ion-col>
  </ion-row>
    
  <ion-toolbar class="header-filter">
    <!--<button ion-button clear color="dark" no-margin (click)="openFilter()" class="disable-hover button-drop">
      <span [attr.primary]="filter.open=='filter' ? true : null">{{'categories.filter'|translate}}</span>
      <ion-icon name="md-arrow-dropdown"></ion-icon>
    </button>
    <button ion-button clear color="dark" no-margin (click)="openSort()" class="disable-hover button-drop">
      <span [attr.primary]="filter.open=='sort' ? true : null">{{'categories.sort'|translate}}</span>
      <ion-icon name="md-arrow-dropdown"></ion-icon>
    </button>-->
    <div float-right>
      <button float-right ion-button clear color="dark" no-margin class="disable-hover" [ngClass]="{'disabled':filter.grid}" (click)="filter.grid=false">
        <ion-icon name="list"></ion-icon>
      </button>
      <button float-right ion-button clear color="dark" no-margin class="disable-hover" [ngClass]="{'disabled':!filter.grid}" (click)="filter.grid=true">
        <ion-icon name="grid"></ion-icon>
      </button>
    </div>
  </ion-toolbar>
  <div (swipe)="onSwipeContent($event)" height-100>
    <!-- Filter -->
    <div *ngIf="filter.open=='filter'" ion-fixed width-100 height-100 light-bg>
      <ion-scroll width-100 height-100 scrollY="true">
        <ion-list>
          <!-- Range Price -->
          <hide-show color="light">
            <span this-title>
              <b>{{'categories.price_range'|translate}}</b>
              <span>{{range.lower|price}}</span>
              <span *ngIf="0<range.upper"> - {{range.upper|price}}</span>
            </span>
            <ion-range mode="md" this-content dualKnobs="true" [min]="attributes.min_price" [max]="attributes.max_price" [(ngModel)]="range">
            </ion-range>
          </hide-show>
          <hide-show color="light" *ngFor="let attr of attributes.attributes" class="filter-attribute">
            <span this-title>
              <b text-capitalize [innerHTML]="attr.name"></b>
            </span>
            <ion-row wrap this-content padding-bottom>
              <ion-col width-50 *ngFor="let term of attr.term" no-padding>
                <ion-item mode="md" no-padding>
                  <ion-label [innerHTML]="term.name"></ion-label>
                  <ion-checkbox [(ngModel)]="filter.value[attr.slug][term.slug]"></ion-checkbox>
                </ion-item>
              </ion-col>
            </ion-row>
          </hide-show>
          <hide-show color="light" *ngFor="let attr of attributes.custom" class="filter-attribute">
            <span this-title>
              <b text-capitalize [innerHTML]="attr.name"></b>
            </span>
            <ion-row wrap this-content padding-bottom>
              <ion-col width-50 *ngFor="let term of attr.term|ObjectToArray" no-padding>
                <ion-item mode="md" no-padding>
                  <ion-label [innerHTML]="term.name"></ion-label>
                  <ion-checkbox [(ngModel)]="filter.valueCustom[attr.slug][term.slug]"></ion-checkbox>
                </ion-item>
              </ion-col>
            </ion-row>
          </hide-show>
        </ion-list>
      </ion-scroll>
    </div>
    <!-- Sort -->
    <div *ngIf="filter.open=='sort'" ion-fixed width-100 height-100 mark tappable (click)="filter.open=null">
      <ion-list radio-group [(ngModel)]="sort" class="list-sort" (ngModelChange)="filter.open=null">
        <ion-item *ngFor="let option of 'categories.sortData'|translate">
          <ion-label [innerHTML]="option.text"></ion-label>
          <ion-radio [value]="option.value"></ion-radio>
        </ion-item>
      </ion-list>
    </div>
    <!-- No result -->
    <ion-row center ion-fixed width-100 height-100 *ngIf="noResuilt" (swipe)="onSwipeContent($event)">
      <ion-col width-100 text-center>{{'search.no_result'|translate}}</ion-col>
    </ion-row>
    <!-- Has result -->
    <!-- List products -->
    <ion-row padding-8 wrap *ngIf="0< products.length" [ngClass]="{'filter-list':!filter.grid}" (swipe)="onSwipeContent($event)">
      <ion-col padding-8 relative [attr.width-50]="filter.grid ? true : null" *ngFor="let product of products" class="product-block">
        <div float-left [navPush]="DetailPage" [navParams]="{id:product.id}">
            <img-loader useImg float-left *ngIf="product.modernshop_images[0].modern_square" src="{{product.modernshop_images[0].modern_square}}" [class.width-45]="!filter.grid ? true : null"></img-loader>
            <img float-left *ngIf="!product.modernshop_images || !product.modernshop_images[0].modern_square" src="assets/images/no-image.png" />
            <span class="product-title capFirst" text-lowercase dark [innerHTML]="product.name.substring(0,25)" style="margin-top:5%"></span>
            <b light-green font-110 align-right float-right  style="margin-top:5%">{{product.price*1||0|price}} &nbsp;&nbsp;<ion-icon *ngIf="!filter.grid ? true : null" dark name="arrow-forward"></ion-icon></b>
        </div>
      </ion-col>
    </ion-row>
    <ion-infinite-scroll (ionInfinite)="load($event)" *ngIf="!over">
      <ion-infinite-scroll-content></ion-infinite-scroll-content>
    </ion-infinite-scroll>
  </div>
</ion-content>
